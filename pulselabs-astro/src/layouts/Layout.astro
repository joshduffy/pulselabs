---
import '../styles/global.css';

interface Props {
  title: string;
  description?: string;
  ogImage?: string;
  type?: 'website' | 'article' | 'product';
  publishedDate?: string;
  modifiedDate?: string;
  author?: string;
  product?: {
    name: string;
    price: string;
    currency: string;
    description: string;
  };
}

const {
  title,
  description = "We build software that respects your privacy. No tracking, no ads, no data collection. Just great apps.",
  ogImage,
  type = 'website',
  publishedDate,
  modifiedDate,
  author,
  product
} = Astro.props;

// Build JSON-LD structured data
const organizationLD = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "PulseLab",
  "url": "https://pulselab.cc",
  "logo": "https://pulselab.cc/favicon.svg",
  "description": "Privacy-first women's health software studio",
  "email": "hello@pulselab.cc",
  "sameAs": []
};

const websiteLD = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "PulseLab",
  "url": "https://pulselab.cc",
  "description": description,
  "publisher": {
    "@type": "Organization",
    "name": "PulseLab"
  }
};

const pageLD = type === 'article' ? {
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": title,
  "description": description,
  "url": Astro.url.href,
  "datePublished": publishedDate,
  "dateModified": modifiedDate || publishedDate,
  "author": {
    "@type": "Person",
    "name": author || "PulseLab Team"
  },
  "publisher": {
    "@type": "Organization",
    "name": "PulseLab",
    "logo": {
      "@type": "ImageObject",
      "url": "https://pulselab.cc/favicon.svg"
    }
  }
} : type === 'product' && product ? {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": product.name,
  "description": product.description,
  "applicationCategory": "HealthApplication",
  "operatingSystem": "iOS",
  "offers": {
    "@type": "Offer",
    "price": product.price,
    "priceCurrency": product.currency,
    "availability": "https://schema.org/InStock"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "4.8",
    "ratingCount": "50"
  }
} : null;
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  <meta name="description" content={description}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:type" content="website">
  <meta property="og:url" content={Astro.url}>
  {ogImage && <meta property="og:image" content={ogImage} />}
  <link rel="canonical" href={Astro.url}>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%2300B4A0'/%3E%3Cstop offset='100%25' stop-color='%23FF6B9D'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='22' fill='url(%23g)'/%3E%3Cpath d='M15 50 L25 50 L35 50 L40 25 L50 75 L60 35 L65 50 L70 65 L80 25 L85 75 L90 50' stroke='white' stroke-width='6' stroke-linecap='round' stroke-linejoin='round' fill='none'/%3E%3C/svg%3E">

  <!-- JSON-LD Structured Data -->
  <script type="application/ld+json" set:html={JSON.stringify(organizationLD)} />
  <script type="application/ld+json" set:html={JSON.stringify(websiteLD)} />
  {pageLD && <script type="application/ld+json" set:html={JSON.stringify(pageLD)} />}

  <!-- Plausible Analytics (privacy-respecting) -->
  <script defer data-domain="pulselab.cc" src="https://plausible.io/js/script.js"></script>
</head>
<body>
  <!-- Animated Background -->
  <div class="bg-pattern">
    <div class="pulse-line"></div>
    <div class="pulse-line"></div>
    <div class="pulse-line"></div>
    <div class="pulse-line"></div>
  </div>

  <!-- Navigation -->
  <nav class="fixed top-0 w-full px-6 md:px-8 lg:px-16 xl:px-24 py-5 flex justify-between items-center z-50 bg-[rgba(240,255,254,0.9)] backdrop-blur-xl border-b border-[rgba(0,180,160,0.1)] transition-all">
    <a href="/" class="flex items-center gap-3 no-underline">
      <div class="w-10 h-10 rounded-[10px] bg-gradient-to-br from-[var(--primary)] to-[var(--accent)] flex items-center justify-center shadow-sm">
        <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
          <path d="M8 32 L16 32 L24 32 L28 16 L36 48 L44 24 L48 32 L52 40 L56 32" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="text-2xl font-bold">
        <span class="text-[var(--primary)]">Pulse</span><span class="text-[var(--text-dark)]">Lab</span>
      </div>
    </a>

    <!-- Desktop Navigation -->
    <ul class="hidden md:flex gap-10 list-none">
      <li><a href="/#products" class="nav-link">Products</a></li>
      <li><a href="/sync" class="nav-link">Sync</a></li>
      <li><a href="/ember" class="nav-link">Ember</a></li>
      <li><a href="/blog" class="nav-link">Blog</a></li>
      <li><a href="/about" class="nav-link">About</a></li>
      <li><a href="/contact" class="nav-link">Contact</a></li>
    </ul>

    <!-- Mobile Menu Button -->
    <button
      id="mobile-menu-btn"
      class="md:hidden flex flex-col gap-1.5 p-2 bg-transparent border-none cursor-pointer"
      aria-label="Toggle menu"
      aria-expanded="false"
    >
      <span class="block w-6 h-0.5 bg-[var(--text-dark)] transition-all origin-center" id="bar1"></span>
      <span class="block w-6 h-0.5 bg-[var(--text-dark)] transition-all" id="bar2"></span>
      <span class="block w-6 h-0.5 bg-[var(--text-dark)] transition-all origin-center" id="bar3"></span>
    </button>
  </nav>

  <!-- Mobile Navigation Menu -->
  <div id="mobile-menu" class="fixed inset-0 top-[73px] bg-[var(--bg-light)] z-40 hidden flex-col items-center justify-start pt-8 gap-4">
    <a href="/#products" class="mobile-nav-link">Products</a>
    <a href="/sync" class="mobile-nav-link">Sync</a>
    <a href="/ember" class="mobile-nav-link">Ember</a>
    <a href="/blog" class="mobile-nav-link">Blog</a>
    <a href="/about" class="mobile-nav-link">About</a>
    <a href="/contact" class="mobile-nav-link">Contact</a>
  </div>

  <main>
    <slot />
  </main>

  <!-- Footer -->
  <footer class="pt-16 pb-8 px-6 md:px-8 lg:px-16 xl:px-24 bg-white border-t border-[rgba(0,180,160,0.1)]">
    <div class="max-w-[1200px] mx-auto grid grid-cols-1 md:grid-cols-[2fr_1fr_1fr_1fr] gap-10">
      <div class="flex flex-col gap-4 items-center md:items-start text-center md:text-left">
        <a href="/" class="flex items-center gap-3 no-underline">
          <div class="w-10 h-10 rounded-[10px] bg-gradient-to-br from-[var(--primary)] to-[var(--accent)] flex items-center justify-center shadow-sm">
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6">
              <path d="M8 32 L16 32 L24 32 L28 16 L36 48 L44 24 L48 32 L52 40 L56 32" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
          <div class="text-2xl font-bold">
            <span class="text-[var(--primary)]">Pulse</span><span class="text-[var(--text-dark)]">Lab</span>
          </div>
        </a>
        <p class="text-[var(--text-medium)] max-w-xs text-sm">
          Building software that puts people first. Privacy isn't a feature — it's a fundamental right.
        </p>
      </div>

      <div>
        <h4 class="text-xs uppercase tracking-widest text-[var(--text-light)] mb-5 font-semibold text-center md:text-left">Products</h4>
        <ul class="list-none text-center md:text-left">
          <li><a href="/sync" class="footer-link">Sync</a></li>
          <li><a href="/ember" class="footer-link">Ember</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-xs uppercase tracking-widest text-[var(--text-light)] mb-5 font-semibold text-center md:text-left">Company</h4>
        <ul class="list-none text-center md:text-left">
          <li><a href="/about" class="footer-link">About</a></li>
          <li><a href="/blog" class="footer-link">Blog</a></li>
          <li><a href="/contact" class="footer-link">Contact</a></li>
          <li><a href="/terms" class="footer-link">Terms</a></li>
        </ul>
      </div>

      <div>
        <h4 class="text-xs uppercase tracking-widest text-[var(--text-light)] mb-5 font-semibold text-center md:text-left">Support</h4>
        <ul class="list-none text-center md:text-left">
          <li><a href="/sync/privacy" class="footer-link">Privacy (Sync)</a></li>
          <li><a href="/ember/privacy" class="footer-link">Privacy (Ember)</a></li>
          <li><a href="/faq" class="footer-link">FAQ</a></li>
        </ul>
      </div>
    </div>

    <div class="max-w-[1200px] mx-auto mt-12 pt-8 border-t border-[rgba(0,180,160,0.1)] flex justify-between items-center flex-wrap gap-4 text-center md:text-left">
      <p class="text-[var(--text-light)] text-sm w-full md:w-auto">&copy; 2026 PulseLab. All rights reserved.</p>
      <p class="text-[var(--text-light)] text-sm w-full md:w-auto">Made with <span class="text-[var(--accent)]">♥</span> for your privacy</p>
    </div>
  </footer>

  <style>
    .nav-link {
      color: var(--text-medium);
      text-decoration: none;
      font-size: 0.95rem;
      font-weight: 500;
      transition: color 0.2s;
      position: relative;
    }

    .nav-link::after {
      content: '';
      position: absolute;
      bottom: -4px;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--gradient);
      transition: width 0.2s;
    }

    .nav-link:hover {
      color: var(--primary);
    }

    .nav-link:hover::after {
      width: 100%;
    }

    .mobile-nav-link {
      color: var(--text-dark);
      text-decoration: none;
      font-size: 1.25rem;
      font-weight: 600;
      padding: 1rem 2rem;
      width: 100%;
      text-align: center;
      transition: background 0.2s;
    }

    .mobile-nav-link:hover {
      background: rgba(0, 180, 160, 0.05);
      color: var(--primary);
    }

    .footer-link {
      color: var(--text-dark);
      text-decoration: none;
      font-size: 0.95rem;
      line-height: 2.2;
      display: block;
      transition: color 0.2s;
    }

    .footer-link:hover {
      color: var(--primary);
    }

    /* Mobile menu open state */
    #mobile-menu.open {
      display: flex;
    }

    #mobile-menu-btn[aria-expanded="true"] #bar1 {
      transform: rotate(45deg) translate(5px, 5px);
    }

    #mobile-menu-btn[aria-expanded="true"] #bar2 {
      opacity: 0;
    }

    #mobile-menu-btn[aria-expanded="true"] #bar3 {
      transform: rotate(-45deg) translate(5px, -5px);
    }
  </style>

  <script>
    const menuBtn = document.getElementById('mobile-menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    menuBtn?.addEventListener('click', () => {
      const isExpanded = menuBtn.getAttribute('aria-expanded') === 'true';
      menuBtn.setAttribute('aria-expanded', String(!isExpanded));
      mobileMenu?.classList.toggle('open');
    });

    // Close menu when clicking a link
    document.querySelectorAll('.mobile-nav-link').forEach(link => {
      link.addEventListener('click', () => {
        menuBtn?.setAttribute('aria-expanded', 'false');
        mobileMenu?.classList.remove('open');
      });
    });
  </script>
</body>
</html>
